<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Career Records - 44 ‚Üí 20</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #d32f2f;
            text-align: center;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 10px;
        }
        .problem {
            background: #ffebee;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .solution {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .sql-box {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: bold;
        }
        .primary {
            background: #4CAF50;
            color: white;
        }
        .primary:hover {
            background: #45a049;
        }
        .secondary {
            background: #2196F3;
            color: white;
        }
        .secondary:hover {
            background: #0b7dda;
        }
        .danger {
            background: #d32f2f;
            color: white;
        }
        .danger:hover {
            background: #b71c1c;
        }
        .step {
            background: #f0f0f0;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .step-number {
            display: inline-block;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-right: 10px;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #d32f2f;
            font-weight: bold;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        th {
            background: #2196F3;
            color: white;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .copy-btn {
            background: #666;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin-left: 10px;
        }
        .copy-btn:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Fix Career Records (44 ‚Üí 20)</h1>
        
        <div class="problem">
            <strong>‚ùå Current Problem:</strong>
            <ul>
                <li>Dashboard shows <strong>44 Total Career Profiles</strong> (should be 20)</li>
                <li>Shows <strong>0% Open for Mentorship</strong> (should be 100%)</li>
                <li>Reason: Too many duplicate records and wrong column values</li>
            </ul>
        </div>

        <div class="solution">
            <strong>‚úÖ Solution:</strong>
            <ul>
                <li>Delete ALL career_info records</li>
                <li>Recreate exactly 20 records for active alumni only</li>
                <li>Set is_employed = false and open_for_mentorship = true</li>
            </ul>
        </div>

        <h2>Expected After Fix</h2>
        <table>
            <tr>
                <th>Metric</th>
                <th>Before (Wrong)</th>
                <th>After (Correct)</th>
            </tr>
            <tr>
                <td>Total Career Profiles</td>
                <td><span class="error">44</span></td>
                <td><span class="success">20</span></td>
            </tr>
            <tr>
                <td>Currently Employed</td>
                <td><span class="error">0%</span></td>
                <td><span class="success">0%</span></td>
            </tr>
            <tr>
                <td>Open for Mentorship</td>
                <td><span class="error">0%</span></td>
                <td><span class="success">100%</span></td>
            </tr>
        </table>

        <h2>SQL to Execute</h2>
        <div class="sql-box" id="sqlContent">-- ============================================================================
-- DIAGNOSTIC: Check what's in career_info table
-- ============================================================================

-- Check total records and their values
SELECT 
    COUNT(*) as total_records,
    COUNT(CASE WHEN is_employed = true THEN 1 END) as employed_count,
    COUNT(CASE WHEN is_employed = false THEN 1 END) as unemployed_count,
    COUNT(CASE WHEN is_employed IS NULL THEN 1 END) as employed_null_count,
    COUNT(CASE WHEN open_for_mentorship = true THEN 1 END) as mentorship_true,
    COUNT(CASE WHEN open_for_mentorship = false THEN 1 END) as mentorship_false,
    COUNT(CASE WHEN open_for_mentorship IS NULL THEN 1 END) as mentorship_null
FROM public.career_info;

-- Check alumni count
SELECT COUNT(*) as total_alumni FROM public.alumni_profiles WHERE is_active = true;

-- See sample records
SELECT alumni_id, is_employed, open_for_mentorship FROM public.career_info LIMIT 10;

-- ============================================================================
-- FIX: Clean up and recreate properly
-- ============================================================================

-- Delete ALL career_info records
DELETE FROM public.career_info;

-- Recreate with CORRECT values
INSERT INTO public.career_info (alumni_id, is_employed, open_for_mentorship)
SELECT id, false, true FROM public.alumni_profiles
WHERE is_active = true
ON CONFLICT (alumni_id) DO NOTHING;

-- Verify it worked
SELECT 
    COUNT(*) as total_records,
    COUNT(CASE WHEN open_for_mentorship = true THEN 1 END) as mentorship_open
FROM public.career_info;

SELECT COUNT(*) as active_alumni FROM public.alumni_profiles WHERE is_active = true;</div>

        <div class="button-group">
            <button class="secondary" onclick="copySQLToClipboard()">üìã Copy SQL to Clipboard</button>
            <button class="danger" onclick="showInstructions()">üî¥ Show Fix Instructions</button>
        </div>

        <div id="instructions" style="display: none;">
            <h2>Step-by-Step Instructions</h2>
            
            <div class="step">
                <span class="step-number">1</span>
                <strong>Copy the SQL</strong> - Click the "Copy SQL to Clipboard" button above
            </div>

            <div class="step">
                <span class="step-number">2</span>
                <strong>Open Supabase SQL Editor</strong> - Go to <a href="https://app.supabase.com/project/_/sql/new" target="_blank">Supabase SQL Editor</a>
            </div>

            <div class="step">
                <span class="step-number">3</span>
                <strong>Paste the SQL</strong> - Right-click and paste (Ctrl+V)
            </div>

            <div class="step">
                <span class="step-number">4</span>
                <strong>Execute</strong> - Click the "Run" button or press Ctrl+Enter
                <br><br>
                Expected results:
                <ul>
                    <li>First query: Shows diagnostic info (should show some mentorship_null values = problem)</li>
                    <li>"DELETE <strong>44</strong>" (deletes all bad records)</li>
                    <li>"INSERT <strong>20</strong>" (creates correct records)</li>
                    <li>Final verification: Shows 20 total_records with 20 mentorship_open</li>
                </ul>
            </div>

            <div class="step">
                <span class="step-number">5</span>
                <strong>Return to Dashboard</strong> - Go back to admin dashboard
            </div>

            <div class="step">
                <span class="step-number">6</span>
                <strong>Refresh Page</strong> - Press Ctrl+R or F5 to refresh
            </div>

            <div class="step">
                <span class="step-number">7</span>
                <strong>Verify Results</strong> - Check Alumni Career Overview should show:
                <ul>
                    <li>‚úÖ 20 Total Career Profiles</li>
                    <li>‚úÖ 0% Currently Employed</li>
                    <li>‚úÖ 100% Open for Mentorship</li>
                </ul>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 4px;">
            <strong>üí° Technical Note:</strong><br>
            The issue was that career_info records had NULL values for open_for_mentorship instead of true.
            The new SQL ensures all 20 records have is_employed=false and open_for_mentorship=true.
        </div>
    </div>

    <script>
        function copySQLToClipboard() {
            const sqlContent = document.getElementById('sqlContent').textContent;
            navigator.clipboard.writeText(sqlContent).then(() => {
                alert('‚úÖ SQL copied to clipboard!');
            }).catch(err => {
                alert('‚ùå Failed to copy: ' + err);
            });
        }

        function showInstructions() {
            const elem = document.getElementById('instructions');
            elem.style.display = elem.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>
