digraph ProgramFlowchart {
    rankdir=TB;
    bgcolor="white";
    pad=0.5;
    nodesep=0.6;
    ranksep=1.0;
    
    graph [fontname="Segoe UI", fontsize=14, labelloc="t", label="Bulk Upload Program Flowchart"];
    node [fontname="Segoe UI", fontsize=10, style="filled"];
    edge [fontname="Segoe UI", fontsize=8, color="#4472C4", penwidth=2];
    
    /* Start/End */
    Start [label="START", shape=ellipse, fillcolor="#90EE90", color="#228B22", penwidth=3];
    End [label="END", shape=ellipse, fillcolor="#FFB6C6", color="#DC143C", penwidth=3];
    
    /* Process Steps */
    Step1 [label="Open Upload Page", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step2 [label="Select CSV File", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step3 [label="Parse CSV File", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step4 [label="Display Preview\n(50 records)", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step5 [label="User Confirms Upload", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step6 [label="Connect to Supabase DB", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    LoopStart [label="For Each Record\nin CSV", shape=box, fillcolor="#FFE4B5", color="#FF8C00", penwidth=2];
    Step7 [label="Extract: full_name, email", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step8 [label="Insert to Alumni DB", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step9 [label="Log Success to\nAudit Trail", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step10 [label="Display Results Summary", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    Step11 [label="Refresh Dashboard Data", shape=box, fillcolor="#ADD8E6", color="#0047AB", penwidth=2];
    
    /* Decision Points */
    Check1 [label="File\nValid?", shape=diamond, fillcolor="#FFFFE0", color="#FFD700", penwidth=2];
    Check2 [label="User\nConfirmed?", shape=diamond, fillcolor="#FFFFE0", color="#FFD700", penwidth=2];
    Check3 [label="Record\nValid?", shape=diamond, fillcolor="#FFFFE0", color="#FFD700", penwidth=2];
    Check4 [label="Insert\nSuccess?", shape=diamond, fillcolor="#FFFFE0", color="#FFD700", penwidth=2];
    LoopEnd [label="More\nRecords?", shape=diamond, fillcolor="#FFFFE0", color="#FFD700", penwidth=2];
    
    /* Error Handlers */
    Error1 [label="Show Error", shape=box, fillcolor="#FFB6C6", color="#DC143C", penwidth=2];
    Error2 [label="Log Error &\nSkip Record", shape=box, fillcolor="#FFB6C6", color="#DC143C", penwidth=2];
    
    /* Main Flow */
    Start -> Step1;
    Step1 -> Step2;
    Step2 -> Step3;
    Step3 -> Check1;
    Check1 -> Error1 [label="NO"];
    Error1 -> Step2;
    Check1 -> Step4 [label="YES"];
    Step4 -> Step5;
    Step5 -> Check2;
    Check2 -> Step2 [label="NO"];
    Check2 -> Step6 [label="YES"];
    Step6 -> LoopStart;
    
    /* Loop Flow */
    LoopStart -> Step7;
    Step7 -> Check3;
    Check3 -> Error2 [label="NO"];
    Check3 -> Step8 [label="YES"];
    Step8 -> Check4;
    Check4 -> Error2 [label="NO"];
    Check4 -> Step9 [label="YES"];
    Error2 -> LoopEnd;
    Step9 -> LoopEnd;
    LoopEnd -> LoopStart [label="YES", constraint=false];
    LoopEnd -> Step10 [label="NO"];
    
    /* Final Steps */
    Step10 -> Step11;
    Step11 -> End;
}
